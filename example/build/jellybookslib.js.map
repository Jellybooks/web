{"version":3,"sources":["webpack://jellybookslib/webpack/bootstrap","webpack://jellybookslib/../shared-models/dist/index.js","webpack://jellybookslib/../src/Publication/Publication+JSON.ts","webpack://jellybookslib/../src/Format/MediaType.ts","webpack://jellybookslib/../src/Publication/Properties.ts","webpack://jellybookslib/../src/util/URITemplate.ts","webpack://jellybookslib/../src/Publication/Link.ts","webpack://jellybookslib/../src/Publication/CoreCollection.ts","webpack://jellybookslib/../src/Publication/epub/Layout.ts","webpack://jellybookslib/../src/Publication/epub/Properties+EPUB.ts","webpack://jellybookslib/../src/Publication/presentation/Presentation.ts","webpack://jellybookslib/../src/Publication/ReadingProgression.ts","webpack://jellybookslib/../src/Publication/Metadata.ts","webpack://jellybookslib/../src/Publication/Manifest.ts","webpack://jellybookslib/../src/Publication/Publication.ts","webpack://jellybookslib/../src/index.ts","webpack://jellybookslib/./src/main.ts"],"names":["JSONDictionary","json","JSON","parse","pop","key","value","parseRaw","parseArray","allowingSingle","result","Array","isArray","parseNumber","isNaN","parsePositive","Math","sign","parseDate","Date","MediaType","mediaType","type","subtype","components","replace","split","types","length","toLowerCase","parameters","i","component","parametersString","p","string","encoding","structuredSyntaxSuffix","parts","contains","other","String","matches","equals","isZIP","zip","isJSON","isOPDS","opds1","opds1Entry","opds2","opds2Publication","opdsAuthentication","isAudio","isBitmap","bmp","gif","jpeg","png","tiff","webp","isHTML","html","xhtml","isVideo","isRWPM","readiumAudiobookManifest","divinaManifest","readiumWebPubManifest","aac","aiff","readiumAudiobook","avi","binary","cbz","css","divina","epub","gz","javascript","lpf","mp3","mpeg","ncx","ogg","ogv","opus","otf","pdf","smil","svg","text","ttf","wav","webmAudio","webmVideo","readiumWebPub","w3cWPUBManifest","woff","woff2","xml","zab","Properties","otherProperties","adding","properties","copy","stringify","property","URITemplate","uri","getParameters","regex","match","Set","join","map","m","trim","expand","expandSimpleString","parameter","expandFormStyle","expression","Link","link","href","templated","title","rels","rel","height","width","duration","bitrate","languages","language","alternates","alternate","Links","children","undefined","templateParameters","getTemplateParameters","toAbsoluteHREF","baseUrl","URL","expandTemplate","items","item","Object","setPrototypeOf","prototype","findWithRel","predicate","el","has","find","filterByRel","filter","findWithHref","findIndexWithHref","findIndex","findWithMediaType","filterByMediaType","filterByMediaTypes","mediaTypes","everyIsAudio","every","everyIsBitmap","everyIsHTML","everyIsVideo","everyMatchesMediaType","CoreCollection","links","jsonCollection","metadata","subcollections","makeCollections","collection","EPUBLayout","getContains","getLayout","Presentation","presentation","clipped","fit","orientation","spread","layout","continuous","overflow","layoutOf","reflowable","ReadingProgression","Metadata","identifier","subtitle","artists","authors","colorists","contributors","editors","illustrators","inkers","letterers","narrators","pencilers","translators","description","publishers","imprints","published","modified","subjects","belongsTo","belongsToCollection","belongsToSeries","readingProgression","auto","numberOfPages","otherMetadata","getPresentation","getOtherMetadata","effectiveReadingProgression","primaryLang","lang","includes","RTLLanguages","rtl","ltr","Manifest","manifestJSON","context","readingOrder","resources","tableOfContents","linkWithRel","linksWithRel","push","reduce","acc","val","concat","Publication","manifest","baseURL","selfLink","linkWithHref","flatMap","arr","shortHref","api","createManifest","createPublication","getData","x","_api"],"mappings":"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","file":"jellybookslib.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/main.ts\");\n","\n'use strict'\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./shared-test.cjs.production.min.js')\n} else {\n  module.exports = require('./shared-test.cjs.development.js')\n}\n","/* Copyright 2020 Readium Foundation. All rights reserved.\n * Use of this source code is governed by a BSD-style license,\n * available in the LICENSE file present in the Github repository of the project.\n */\n\n/** Wraps a dictionary parsed from a JSON string or a JSON Object */\nexport class JSONDictionary {\n  public json: any;\n\n  constructor(json: any) {\n    if (typeof json === 'string') {\n      this.json = JSON.parse(json);\n    } else {\n      this.json = json;\n    }\n  }\n\n  /** Removes the given property and returns its value */\n  private pop(key: string) {\n    const value = this.json[key];\n    delete this.json[key];\n    return value;\n  }\n\n  /** Parses the given property AS-IS and removes it */\n  public parseRaw(key: string): any {\n    return this.pop(key);\n  }\n\n  /** Parses the given array and removes it\n   *  Parameter allowingSingle: If true, then allows the parsing of both a single value and an array.\n   */\n  public parseArray(key: string, allowingSingle: boolean = false): Array<any> {\n    const result = this.pop(key);\n    if (Array.isArray(result)) {\n      return result;\n    } else if (allowingSingle) {\n      return [result];\n    }\n    return [];\n  }\n\n  /** Parses a numeric value, but returns null if it is not */\n  public parseNumber(key: string): number | null {\n    const result = this.pop(key);\n    if (!isNaN(result)) {\n      return result;\n    }\n    return null;\n  }\n\n  /** Parses a numeric value, but returns null if it is not a positive number. */\n  public parsePositive(key: string): number | null {\n    const result = this.pop(key);\n    if (!isNaN(result) && Math.sign(result) >= 0) {\n      return result;\n    }\n    return null;\n  }\n\n  /** Parses the given key and returns a Date (or null if it’s not a string) */\n  public parseDate(key: string): Date | null {\n    const result = this.pop(key);\n    if (typeof result === 'string') {\n      return new Date(result);\n    }\n    return null;\n  }\n}\n","/* Copyright 2020 Readium Foundation. All rights reserved.\n * Use of this source code is governed by a BSD-style license,\n * available in the LICENSE file present in the Github repository of the project.\n */\n\ntype ParametersMap = {\n  [param: string]: string;\n};\n\n/** Represents a string media type.\n *  `MediaType` handles:\n *  - components parsing – eg. type, subtype and parameters,\n *  - media types comparison.\n */\nexport class MediaType {\n  /** The type component, e.g. `application` in `application/epub+zip`. */\n  public type: string;\n\n  /** The subtype component, e.g. `epub+zip` in `application/epub+zip`. */\n  public subtype: string;\n\n  /** The parameters in the media type, such as `charset=utf-8`. */\n  public parameters: ParametersMap;\n\n  /** The string representation of this media type. */\n  public string: string;\n\n  /** Encoding as declared in the `charset` parameter, if there's any. */\n  public encoding?: string;\n\n  constructor(mediaType: string) {\n    this.type = '';\n    this.subtype = '';\n    const components = mediaType.replace(/\\s/g, '').split(';');\n    const types = components[0].split('/');\n    if (types.length === 2) {\n      this.type = types[0].toLowerCase();\n      this.subtype = types[1].toLowerCase();\n    }\n\n    let parameters: ParametersMap = {};\n    for (let i = 1; i < components.length; i++) {\n      const component = components[i].split('=');\n      if (component.length === 2) {\n        const key = component[0];\n        const value = component[1];\n        parameters[key] = value;\n      }\n    }\n    this.parameters = parameters;\n\n    let parametersString: string = '';\n    for (const p in parameters) {\n      const value = parameters[p];\n      parametersString += `;${p}=${value}`;\n    }\n    this.string = `${this.type}/${this.subtype}${parametersString}`;\n\n    this.encoding = parameters['encoding'];\n  }\n\n  /** Structured syntax suffix, e.g. `+zip` in `application/epub+zip`.\n   *  Gives a hint on the underlying structure of this media type.\n   *  See. https://tools.ietf.org/html/rfc6838#section-4.2.8\n   */\n  public structuredSyntaxSuffix(): string | null {\n    const parts = this.subtype.split('+');\n    return parts.length > 1 ? `+${parts[parts.length - 1]}` : null;\n  }\n\n  /** Returns whether the given `other` media type is included in this media type.\n   *  For example, `text/html` contains `text/html;charset=utf-8`.\n   *  - `other` must match the parameters in the `parameters` property, but extra parameters\n   *  are ignored.\n   *  - Order of parameters is ignored.\n   *  - Wildcards are supported, meaning that `image/*` contains `image/png`\n   */\n  public contains(other: MediaType | string): boolean {\n    if (typeof other === 'string' || other instanceof String) {\n      other = new MediaType(other as string);\n    }\n    if (\n      (this.type === '*' || this.type === other.type) &&\n      (this.subtype === '*' || this.subtype === other.subtype)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  /** Returns whether this media type and `other` are the same, ignoring parameters that\n   *  are not in both media types.\n   *  For example, `text/html` matches `text/html;charset=utf-8`, but `text/html;charset=ascii`\n   *  doesn't. This is basically like `contains`, but working in both direction.\n   */\n  public matches(other: MediaType | string): boolean {\n    if (typeof other === 'string' || other instanceof String) {\n      other = new MediaType(other as string);\n    }\n    return this.contains(other) || other.contains(this);\n  }\n\n  /** Checks the MediaType equals another one (comparing their string) */\n  public equals(other: MediaType): boolean {\n    return this.string === other.string;\n  }\n\n  /** Returns whether this media type is structured as a ZIP archive. */\n  public isZIP(): boolean {\n    return (\n      this.matches(MediaType.zip()) || this.structuredSyntaxSuffix() === '+zip'\n    );\n  }\n\n  /** Returns whether this media type is structured as a JSON file. */\n  public isJSON(): boolean {\n    return (\n      this.matches(MediaType.json()) ||\n      this.structuredSyntaxSuffix() === '+json'\n    );\n  }\n\n  /** Returns whether this media type is of an OPDS feed. */\n  public isOPDS(): boolean {\n    return (\n      this.matches(MediaType.opds1()) ||\n      this.matches(MediaType.opds1Entry()) ||\n      this.matches(MediaType.opds2()) ||\n      this.matches(MediaType.opds2Publication()) ||\n      this.matches(MediaType.opdsAuthentication())\n    );\n  }\n\n  /** Returns whether this media type is of an audio clip. */\n  public isAudio(): boolean {\n    return this.type === 'audio';\n  }\n\n  /** Returns whether this media type is of a bitmap image, so excluding vectorial formats. */\n  public isBitmap(): boolean {\n    return (\n      this.matches(MediaType.bmp()) ||\n      this.matches(MediaType.gif()) ||\n      this.matches(MediaType.jpeg()) ||\n      this.matches(MediaType.png()) ||\n      this.matches(MediaType.tiff()) ||\n      this.matches(MediaType.webp())\n    );\n  }\n\n  /** Returns whether this media type is of an HTML document. */\n  public isHTML(): boolean {\n    return this.matches(MediaType.html()) || this.matches(MediaType.xhtml());\n  }\n\n  /** Returns whether this media type is of a video clip. */\n  public isVideo(): boolean {\n    return this.type === 'video';\n  }\n\n  /** Returns whether this media type is of a Readium Web Publication Manifest. */\n  public isRWPM(): boolean {\n    return (\n      this.matches(MediaType.readiumAudiobookManifest()) ||\n      this.matches(MediaType.divinaManifest()) ||\n      this.matches(MediaType.readiumWebPubManifest())\n    );\n  }\n\n  // Known Media Types\n\n  public static aac(): MediaType {\n    return new this('audio/aac');\n  }\n\n  public static aiff(): MediaType {\n    return new this('audio/aiff');\n  }\n\n  public static readiumAudiobook(): MediaType {\n    return new this('application/audiobook+zip');\n  }\n\n  public static readiumAudiobookManifest(): MediaType {\n    return new this('application/audiobook+json');\n  }\n\n  public static avi(): MediaType {\n    return new this('video/x-msvideo');\n  }\n\n  public static binary(): MediaType {\n    return new this('application/octet-stream');\n  }\n\n  public static bmp(): MediaType {\n    return new this('image/bmp');\n  }\n\n  public static cbz(): MediaType {\n    return new this('application/vnd.comicbook+zip');\n  }\n\n  public static css(): MediaType {\n    return new this('text/css');\n  }\n\n  public static divina(): MediaType {\n    return new this('application/divina+zip');\n  }\n\n  public static divinaManifest(): MediaType {\n    return new this('application/divina+json');\n  }\n\n  public static epub(): MediaType {\n    return new this('application/epub+zip');\n  }\n\n  public static gif(): MediaType {\n    return new this('image/gif');\n  }\n\n  public static gz(): MediaType {\n    return new this('application/gzip');\n  }\n\n  public static html(): MediaType {\n    return new this('text/html');\n  }\n\n  public static javascript(): MediaType {\n    return new this('text/javascript');\n  }\n\n  public static jpeg(): MediaType {\n    return new this('image/jpeg');\n  }\n\n  public static json(): MediaType {\n    return new this('application/json');\n  }\n\n  public static lpf(): MediaType {\n    return new this('application/audiobook+lcp');\n  }\n\n  public static mp3(): MediaType {\n    return new this('audio/mpeg');\n  }\n\n  public static mpeg(): MediaType {\n    return new this('video/mpeg');\n  }\n\n  public static ncx(): MediaType {\n    return new this('application/x-dtbncx+xml');\n  }\n\n  public static ogg(): MediaType {\n    return new this('audio/ogg');\n  }\n\n  public static ogv(): MediaType {\n    return new this('video/ogg');\n  }\n\n  public static opds1(): MediaType {\n    return new this('application/atom+xml;profile=opds-catalog');\n  }\n\n  public static opds1Entry(): MediaType {\n    return new this('application/atom+xml;type=entry;profile=opds-catalog');\n  }\n\n  public static opds2(): MediaType {\n    return new this('application/opds+json');\n  }\n\n  public static opds2Publication(): MediaType {\n    return new this('application/opds-publication+json');\n  }\n\n  public static opdsAuthentication(): MediaType {\n    return new this('application/opds-authentication+json');\n  }\n\n  public static opus(): MediaType {\n    return new this('audio/opus');\n  }\n\n  public static otf(): MediaType {\n    return new this('font/otf');\n  }\n\n  public static pdf(): MediaType {\n    return new this('application/pdf');\n  }\n\n  public static png(): MediaType {\n    return new this('image/png');\n  }\n\n  public static smil(): MediaType {\n    return new this('application/smil+xml');\n  }\n\n  public static svg(): MediaType {\n    return new this('image/svg+xml');\n  }\n\n  public static text(): MediaType {\n    return new this('text/plain');\n  }\n\n  public static tiff(): MediaType {\n    return new this('image/tiff');\n  }\n\n  public static ttf(): MediaType {\n    return new this('font/ttf');\n  }\n\n  public static wav(): MediaType {\n    return new this('audio/wav');\n  }\n\n  public static webmAudio(): MediaType {\n    return new this('audio/webm');\n  }\n\n  public static webmVideo(): MediaType {\n    return new this('video/webm');\n  }\n\n  public static webp(): MediaType {\n    return new this('image/webp');\n  }\n\n  public static readiumWebPub(): MediaType {\n    return new this('application/webpub+zip');\n  }\n\n  public static readiumWebPubManifest(): MediaType {\n    return new this('application/webpub+json');\n  }\n\n  public static w3cWPUBManifest(): MediaType {\n    return new this('application/x.readium.w3c.wpub+json');\n  }\n\n  public static woff(): MediaType {\n    return new this('font/woff');\n  }\n\n  public static woff2(): MediaType {\n    return new this('font/woff2');\n  }\n\n  public static xhtml(): MediaType {\n    return new this('application/xhtml+xml');\n  }\n\n  public static xml(): MediaType {\n    return new this('application/xml');\n  }\n\n  public static zab(): MediaType {\n    return new this('application/x.readium.zab+zip');\n  }\n\n  public static zip(): MediaType {\n    return new this('application/zip');\n  }\n}\n","/* Copyright 2020 Readium Foundation. All rights reserved.\n * Use of this source code is governed by a BSD-style license,\n * available in the LICENSE file present in the Github repository of the project.\n */\n\nexport class Properties {\n  public otherProperties: { [key: string]: any };\n\n  constructor(json: any) {\n    if (typeof json === 'string') {\n      this.otherProperties = JSON.parse(json);\n    } else {\n      this.otherProperties = json;\n    }\n  }\n\n  public adding(properties: { [key: string]: any }): Properties {\n    let copy = JSON.parse(JSON.stringify(this.otherProperties));\n    for (const property in properties) {\n      copy[property] = properties[property];\n    }\n    return new Properties(copy);\n  }\n}\n","/* Copyright 2020 Readium Foundation. All rights reserved.\n * Use of this source code is governed by a BSD-style license,\n * available in the LICENSE file present in the Github repository of the project.\n */\n\n/** A lightweight implementation of URI Template (RFC 6570).\n *  Only handles simple cases, fitting Readium's use cases.\n *  See https://tools.ietf.org/html/rfc6570\n *\n *  TODO: extensive testing\n */\nexport class URITemplate {\n  public uri: string;\n  public parameters: Set<string>;\n\n  constructor(uri: string) {\n    this.uri = uri;\n\n    /** List of URI template parameter keys. */\n    this.parameters = this.getParameters(uri);\n  }\n\n  private getParameters(uri: string): Set<string> {\n    const regex = /\\{\\??([^}]+)\\}/g;\n    const match = uri.match(regex);\n    if (match) {\n      return new Set(\n        match\n          .join(',')\n          .replace(regex, '$1')\n          .split(',')\n          .map(m => m.trim())\n      );\n    }\n    return new Set();\n  }\n\n  /** Expands the URI by replacing the template variables by the given parameters.\n   *  Any extra parameter is appended as query parameters.\n   *  See RFC 6570 on URI template: https://tools.ietf.org/html/rfc6570\n   */\n  public expand(parameters: { [param: string]: string }): string {\n    const expandSimpleString = (string: string): string => {\n      return string\n        .split(',')\n        .map(parameter => {\n          return parameters[parameter] || '';\n        })\n        .join(',');\n    };\n    const expandFormStyle = (string: string): string => {\n      return (\n        '?' +\n        string\n          .split(',')\n          .map(expression => {\n            const parameter = expression.split('=')[0];\n            if (parameters[parameter]) {\n              return `${parameter}=${parameters[parameter]}`;\n            } else {\n              return '';\n            }\n          })\n          .join('&')\n      );\n    };\n    return this.uri.replace(/\\{(\\??)([^}]+)\\}/g, (...groups: Array<string>) => {\n      return !groups[1]\n        ? expandSimpleString(groups[2])\n        : expandFormStyle(groups[2]);\n    });\n  }\n}\n","/* Copyright 2020 Readium Foundation. All rights reserved.\n * Use of this source code is governed by a BSD-style license,\n * available in the LICENSE file present in the Github repository of the project.\n */\n\nimport { MediaType } from '../Format/MediaType';\nimport { Properties } from './Properties';\nimport { URITemplate } from '../util/URITemplate';\n\n/*  \n    Keeping as ref list of values we know are currently used, per webpub doc:\n    https://github.com/readium/webpub-manifest/blob/master/relationships.md\n    type LinkRel = \"alternate\" | \"contents\" | \"cover\" | \"manifest\" | \"search\" | \"self\"; \n*/\n\nexport interface ILink {\n  href: string;\n  templated?: boolean;\n  type?: string;\n  title?: string;\n  rel?: Array<string>;\n  properties?: Properties;\n  height?: number;\n  width?: number;\n  duration?: number;\n  bitrate?: number;\n  language?: Array<string>;\n  alternate?: Array<ILink>;\n  children?: Array<ILink>;\n}\n\n/** Link Object for the Readium Web Publication Manifest.\n *  https://readium.org/webpub-manifest/schema/link.schema.json\n */\nexport class Link {\n  /** URI or URI template of the linked resource. */\n  public href: string;\n\n  /** Indicates that a URI template is used in href. */\n  public templated?: boolean;\n\n  /** MIME type of the linked resource. */\n  public type?: string;\n\n  /** Title of the linked resource. */\n  public title?: string;\n\n  /** Relation between the linked resource and its containing collection. */\n  public rels: Set<string>;\n\n  /** Properties associated to the linked resource. */\n  public properties: Properties;\n\n  /** Height of the linked resource in pixels. */\n  public height?: number;\n\n  /** Width of the linked resource in pixels. */\n  public width?: number;\n\n  /** Length of the linked resource in seconds. */\n  public duration?: number;\n\n  /** Bitrate of the linked resource in kbps. */\n  public bitrate?: number;\n\n  /** Expected language of the linked resource. */\n  public languages?: Array<string>;\n\n  /** Alternate resources for the linked resource. */\n  public alternates: Links;\n\n  /** Resources that are children of the linked resource, in the context of a given collection role. */\n  public children: Links;\n\n  /** MediaType of the linked resource. */\n  public mediaType?: MediaType;\n\n  public templateParameters: Set<string>;\n\n  constructor(link: ILink) {\n    this.href = link.href;\n    this.templated = link.templated;\n    this.type = link.type;\n    this.title = link.title;\n    this.rels = new Set(link.rel);\n    this.properties = new Properties(link.properties);\n    this.height = link.height;\n    this.width = link.width;\n    this.duration = link.duration;\n    this.bitrate = link.bitrate;\n    this.languages = link.language;\n    this.alternates = link.alternate\n      ? new Links(link.alternate)\n      : new Links([]);\n    this.children = link.children ? new Links(link.children) : new Links([]);\n    this.mediaType = link.type ? new MediaType(link.type) : undefined;\n    this.templateParameters = this.getTemplateParameters();\n  }\n\n  /** Computes an absolute URL to the link, relative to the given `baseURL`.\n   *  If the link's `href` is already absolute, the `baseURL` is ignored.\n   */\n  public toAbsoluteHREF(baseUrl: string): string {\n    return new URL(this.href, baseUrl).href;\n  }\n\n  /** List of URI template parameter keys, if the `Link` is templated. */\n  private getTemplateParameters(): Set<string> {\n    if (!this.templated) {\n      return new Set();\n    } else {\n      return new URITemplate(this.href).parameters;\n    }\n  }\n\n  /** Expands the `Link`'s HREF by replacing URI template variables by the given parameters.\n   *  See RFC 6570 on URI template: https://tools.ietf.org/html/rfc6570\n   */\n  public expandTemplate(parameters: { [param: string]: string }): Link {\n    // Probably make copy instead of a new one\n    return new Link({\n      href: new URITemplate(this.href).expand(parameters),\n      templated: false,\n    });\n  }\n}\n\n/** Parses multiple JSON links into an array of Link. */\nexport class Links extends Array<Link> {\n  constructor(items: Array<ILink> | number) {\n    if (items instanceof Array) {\n      super(...items.map(item => new Link(item)));\n    } else {\n      super(items);\n    }\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n\n  /** Finds the first link with the given relation. */\n  public findWithRel(rel: string): Link | null {\n    const predicate = (el: Link) => el.rels.has(rel);\n    return this.find(predicate) || null;\n  }\n\n  /** Finds all the links with the given relation. */\n  public filterByRel(rel: string): Array<Link> {\n    const predicate = (el: Link) => el.rels.has(rel);\n    return this.filter(predicate);\n  }\n\n  /** Finds the first link matching the given HREF. */\n  public findWithHref(href: string): Link | null {\n    const predicate = (el: Link) => el.href === href;\n    return this.find(predicate) || null;\n  }\n\n  /** Finds the index of the first link matching the given HREF. */\n  public findIndexWithHref(href: string): number {\n    const predicate = (el: Link) => el.href === href;\n    return this.findIndex(predicate);\n  }\n\n  /** Finds the first link matching the given media type. */\n  public findWithMediaType(mediaType: string): Link | null {\n    const predicate = (el: Link) =>\n      el.mediaType ? el.mediaType.matches(mediaType) : false;\n    return this.find(predicate) || null;\n  }\n\n  /** Finds all the links matching the given media type. */\n  public filterByMediaType(mediaType: string): Array<Link> {\n    const predicate = (el: Link) =>\n      el.mediaType ? el.mediaType.matches(mediaType) : false;\n    return this.filter(predicate);\n  }\n\n  /** Finds all the links matching any of the given media types. */\n  public filterByMediaTypes(mediaTypes: Array<string>): Array<Link> {\n    const predicate = (el: Link) => {\n      for (const mediaType of mediaTypes) {\n        return el.mediaType ? el.mediaType.matches(mediaType) : false;\n      }\n      return false;\n    };\n    return this.filter(predicate);\n  }\n\n  /** Returns whether all the resources in the collection are audio clips. */\n  public everyIsAudio(): boolean {\n    const predicate = (el: Link) =>\n      el.mediaType ? el.mediaType.isAudio() : false;\n    return this.every(predicate);\n  }\n\n  /** Returns whether all the resources in the collection are bitmaps. */\n  public everyIsBitmap(): boolean {\n    const predicate = (el: Link) =>\n      el.mediaType ? el.mediaType.isBitmap() : false;\n    return this.every(predicate);\n  }\n\n  /** Returns whether all the resources in the collection are HTML documents. */\n  public everyIsHTML(): boolean {\n    const predicate = (el: Link) =>\n      el.mediaType ? el.mediaType.isHTML() : false;\n    return this.every(predicate);\n  }\n\n  /** Returns whether all the resources in the collection are video clips. */\n  public everyIsVideo(): boolean {\n    const predicate = (el: Link) =>\n      el.mediaType ? el.mediaType.isVideo() : false;\n    return this.every(predicate);\n  }\n\n  /** Returns whether all the resources in the collection are matching any of the given media types. */\n  public everyMatchesMediaType(mediaTypes: string | Array<string>): boolean {\n    if (Array.isArray(mediaTypes)) {\n      return this.every((el: Link) => {\n        for (const mediaType of mediaTypes) {\n          return el.mediaType ? el.mediaType.matches(mediaType) : false;\n        }\n        return false;\n      });\n    } else {\n      return this.every((el: Link) =>\n        el.mediaType ? el.mediaType.matches(mediaTypes) : false\n      );\n    }\n  }\n}\n","/* Copyright 2020 Readium Foundation. All rights reserved.\n * Use of this source code is governed by a BSD-style license,\n * available in the LICENSE file present in the Github repository of the project.\n */\n\nimport { JSONDictionary } from './Publication+JSON';\nimport { Links } from './Link';\n\n/** Core Collection Model\n *  https://readium.org/webpub-manifest/schema/subcollection.schema.json\n *  Can be used as extension point in the Readium Web Publication Manifest.\n */\nexport class CoreCollection {\n  public metadata?: { [key: string]: any };\n  public links?: Links;\n\n  /** Subcollections indexed by their role in this collection. */\n  public subcollections?: { [collection: string]: CoreCollection };\n\n  constructor(json: any) {\n    if (Array.isArray(json)) {\n      this.links = new Links(json);\n    } else {\n      const jsonCollection = new JSONDictionary(json);\n      this.metadata = jsonCollection.parseRaw('metadata');\n      this.links = new Links(jsonCollection.parseArray('links'));\n      this.subcollections = CoreCollection.makeCollections(jsonCollection);\n    }\n  }\n\n  public static makeCollections(\n    json: any\n  ): { [collection: string]: CoreCollection } {\n    let collection: { [key: string]: any } = {};\n    for (const key in json) {\n      collection[key] = new this(json[key]);\n    }\n    return collection;\n  }\n}\n","/* Copyright 2020 Readium Foundation. All rights reserved.\n * Use of this source code is governed by a BSD-style license,\n * available in the LICENSE file present in the Github repository of the project.\n */\n\n/** Hint about the nature of the layout for the linked resources. */\nexport enum EPUBLayout {\n  fixed = 'fixed',\n  reflowable = 'reflowable',\n}\n","/* Copyright 2020 Readium Foundation. All rights reserved.\n * Use of this source code is governed by a BSD-style license,\n * available in the LICENSE file present in the Github repository of the project.\n */\n\nimport { EPUBLayout } from './Layout';\nimport { Properties } from '../Properties';\n\ndeclare module '../Properties' {\n  export interface Properties {\n    getContains: () => Array<string>;\n    getLayout: () => EPUBLayout | null;\n  }\n}\n\nProperties.prototype.getContains = function() {\n  return this.otherProperties['contains'] || [];\n};\n\nProperties.prototype.getLayout = function() {\n  return this.otherProperties['layout'] || null;\n};\n","/* Copyright 2020 Readium Foundation. All rights reserved.\n * Use of this source code is governed by a BSD-style license,\n * available in the LICENSE file present in the Github repository of the project.\n */\n\nimport { EPUBLayout } from '../epub/Layout';\nimport { Link } from '../Link';\nimport '../epub/Properties+EPUB';\n\nexport type Orientation = 'auto' | 'landscape' | 'portrait';\nexport type Overflow = 'auto' | 'clipped' | 'paginated' | 'scrolled';\nexport type Page = 'left' | 'right' | 'center';\nexport type Spread = 'auto' | 'both' | 'none' | 'landscape';\nexport type Fit = 'contain' | 'cover' | 'width' | 'height';\n\nexport interface IPresentationMetadata {\n  clipped?: boolean;\n  continuous?: boolean;\n  fit?: Fit;\n  orientation?: Orientation;\n  overflow?: Overflow;\n  spread?: Spread;\n  layout?: EPUBLayout;\n}\n\n/** The Presentation Hints extension defines a number of hints for User Agents about the way content\n *  should be presented to the user.\n *\n *  https://readium.org/webpub-manifest/extensions/presentation.html\n *  https://readium.org/webpub-manifest/schema/extensions/presentation/metadata.schema.json\n *\n *  These properties are nullable to avoid having default values when it doesn't make sense for a\n *  given `Publication`. If a navigator needs a default value when not specified,\n *  `Presentation.defaultX` and `Presentation.X.default` can be used.\n */\nexport class Presentation {\n  /** Specifies whether or not the parts of a linked resource that flow out of the viewport are clipped */\n  public clipped?: boolean;\n\n  /** Suggested method for constraining a resource inside the viewport. */\n  public fit?: Fit;\n\n  /** Suggested orientation for the device when displaying the linked resource. */\n  public orientation?: Orientation;\n\n  /** Indicates the condition to be met for the linked resource to be rendered\n   *  within a synthetic spread\n   */\n  public spread?: Spread;\n\n  /** Hint about the nature of the layout for the linked resources (EPUB extension). */\n  public layout?: EPUBLayout;\n\n  /** Indicates how the progression between resources from the [readingOrder] should be handled */\n  public continuous?: boolean;\n\n  /** Indicates if the overflow of linked resources from the `readingOrder` or `resources` should\n   *  be handled using dynamic pagination or scrolling.\n   */\n  public overflow?: Overflow;\n\n  constructor(presentation: IPresentationMetadata) {\n    this.clipped = presentation.clipped;\n    this.fit = presentation.fit;\n    this.orientation = presentation.orientation;\n    this.spread = presentation.spread;\n    this.layout = presentation.layout;\n    this.continuous = presentation.continuous;\n    this.overflow = presentation.overflow;\n  }\n\n  /** Determines the layout of the given resource in this publication.\n   *  Default layout is reflowable.\n   */\n  public layoutOf(link: Link): EPUBLayout {\n    let result = EPUBLayout.reflowable;\n    if (link.properties && link.properties.getLayout() !== null) {\n      result = link.properties.getLayout() as EPUBLayout;\n    } else if (this.layout) {\n      result = this.layout;\n    }\n    return result;\n  }\n}\n","/* Copyright 2020 Readium Foundation. All rights reserved.\n * Use of this source code is governed by a BSD-style license,\n * available in the LICENSE file present in the Github repository of the project.\n */\n\nimport { Page } from './presentation/Presentation';\n\nexport enum ReadingProgression {\n  auto = 'auto',\n  btt = 'btt',\n  ltr = 'ltr',\n  rtl = 'rtl',\n  ttb = 'ttb',\n}\n\n// Note: Babel doesn’t really like that at all so disabling for the time being\n// export namespace ReadingProgression {\nexport function leadingPage(readingProgression: ReadingProgression): Page {\n  switch (readingProgression) {\n    case ReadingProgression.auto:\n    case ReadingProgression.ttb:\n    case ReadingProgression.ltr:\n      return 'left';\n    case ReadingProgression.rtl:\n    case ReadingProgression.btt:\n      return 'right';\n    default:\n      return 'left';\n  }\n}\n// }\n","/* Copyright 2020 Readium Foundation. All rights reserved.\n * Use of this source code is governed by a BSD-style license,\n * available in the LICENSE file present in the Github repository of the project.\n */\n\nimport { IContributor } from './Contributor';\nimport { ILocalizedString } from './LocalizedString';\nimport { IPresentable } from './presentation/IPresentable';\nimport { Presentation } from './presentation/Presentation';\nimport { JSONDictionary } from './Publication+JSON';\nimport { ReadingProgression } from './ReadingProgression';\nimport { Subject } from './Subject';\n\ntype Collection = IContributor;\n\n/** https://readium.org/webpub-manifest/schema/metadata.schema.json */\nexport interface IMetadata {\n  title: string | ILocalizedString;\n  '@type'?: string;\n  identifier?: string;\n  subtitle?: string | ILocalizedString;\n  artist?: Array<IContributor>;\n  author?: Array<IContributor>;\n  colorist?: Array<IContributor>;\n  contributor?: Array<IContributor>;\n  editor?: Array<IContributor>;\n  illustrator?: Array<IContributor>;\n  inker?: Array<IContributor>;\n  letterer?: Array<IContributor>;\n  narrator?: Array<IContributor>;\n  penciler?: Array<IContributor>;\n  translator?: Array<IContributor>;\n  language?: Array<string>;\n  description?: string;\n  publisher?: Array<IContributor>;\n  imprint?: Array<IContributor>;\n  published?: string | Date;\n  modified?: string | Date;\n  subject?: Array<Subject>;\n  belongsTo?: Array<string>;\n  readingProgression?: ReadingProgression;\n  duration?: number;\n  numberOfPages?: number;\n}\n\nexport class Metadata implements IPresentable {\n  public title: string | ILocalizedString;\n  public '@type'?: string;\n  public identifier?: string;\n  public subtitle?: string | ILocalizedString;\n  public artists: Array<IContributor>;\n  public authors: Array<IContributor>;\n  public colorists: Array<IContributor>;\n  public contributors: Array<IContributor>;\n  public editors: Array<IContributor>;\n  public illustrators: Array<IContributor>;\n  public inkers: Array<IContributor>;\n  public letterers: Array<IContributor>;\n  public narrators: Array<IContributor>;\n  public pencilers: Array<IContributor>;\n  public translators: Array<IContributor>;\n  public languages: Array<string>;\n  public description?: string;\n  public publishers: Array<IContributor>;\n  public imprints: Array<IContributor>;\n  public published: Date | null;\n  public modified: Date | null;\n  public subjects: Array<Subject>;\n  public belongsToCollection?: Array<Collection>;\n  public belongsToSeries?: Array<Collection>;\n\n  /** This contains the reading progression as declared in the manifest, so it might be\n   *  `auto`. To know the effective reading progression used to lay out the content, use\n   *  `effectiveReadingProgression` instead.\n   */\n  public readingProgression: ReadingProgression;\n  public duration: number | null;\n  public numberOfPages: number | null;\n  private otherMetadata: { [key: string]: any };\n\n  /* public otherMetadata */\n\n  private static readonly RTLLanguages = ['ar', 'fa', 'he', 'zh-Hant', 'zh-TW'];\n\n  constructor(metadata: IMetadata) {\n    const json = new JSONDictionary(metadata);\n\n    this.title = json.parseRaw('title');\n    this['@type'] = json.parseRaw('@type');\n    this.identifier = json.parseRaw('identifier');\n    this.subtitle = json.parseRaw('subtitle');\n    this.artists = json.parseArray('artist');\n    this.authors = json.parseArray('author');\n    this.colorists = json.parseArray('colorist');\n    this.contributors = json.parseArray('contributor');\n    this.editors = json.parseArray('editor');\n    this.illustrators = json.parseArray('illustrator');\n    this.inkers = json.parseArray('inker');\n    this.letterers = json.parseArray('letterer');\n    this.narrators = json.parseArray('narrator');\n    this.pencilers = json.parseArray('penciler');\n    this.translators = json.parseArray('translator');\n    this.languages = json.parseArray('language');\n    this.description = json.parseRaw('description');\n    this.publishers = json.parseArray('publisher');\n    this.imprints = json.parseArray('imprint');\n    this.published = json.parseDate('published');\n    this.modified = json.parseDate('modified');\n    this.subjects = json.parseArray('subject');\n    const belongsTo = json.parseRaw('belongsTo');\n    this.belongsToCollection = belongsTo ? belongsTo['collection'] : [];\n    this.belongsToSeries = belongsTo ? belongsTo['series'] : [];\n    this.readingProgression =\n      json.parseRaw('readingProgression') || ReadingProgression.auto;\n    this.duration = json.parsePositive('duration');\n    this.numberOfPages = json.parsePositive('numberOfPages');\n    this.otherMetadata = json.json;\n  }\n\n  public getPresentation(): Presentation {\n    return this.getOtherMetadata()['presentation']\n      ? new Presentation(this.getOtherMetadata()['presentation'])\n      : new Presentation({});\n  }\n\n  /** Computes a `ReadingProgression` when the value of `readingProgression` is set to `auto`,\n   *  using the publication language.\n   */\n  public effectiveReadingProgression(): ReadingProgression {\n    if (\n      this.readingProgression &&\n      this.readingProgression !== ReadingProgression.auto\n    ) {\n      return this.readingProgression;\n    }\n\n    if (this.languages.length > 0) {\n      const primaryLang = this.languages[0];\n      const lang = primaryLang.includes('zh')\n        ? primaryLang\n        : primaryLang.split('-')[0];\n      if (Metadata.RTLLanguages.includes(lang)) {\n        return ReadingProgression.rtl;\n      }\n    }\n\n    return ReadingProgression.ltr;\n  }\n\n  public getOtherMetadata(): { [key: string]: any } {\n    return this.otherMetadata;\n  }\n}\n","/* Copyright 2020 Readium Foundation. All rights reserved.\n * Use of this source code is governed by a BSD-style license,\n * available in the LICENSE file present in the Github repository of the project.\n */\n\nimport { CoreCollection } from './CoreCollection';\nimport { JSONDictionary } from './Publication+JSON';\nimport { Link, Links } from './Link';\nimport { Metadata } from './Metadata';\n\n/** Holds the metadata of a Readium publication, as described in\n *  the Readium Web Publication Manifest.\n *  See. https://readium.org/webpub-manifest/\n */\nexport class Manifest {\n  public readonly context: Array<string>;\n  public readonly metadata: Metadata;\n  public readonly links: Links;\n\n  /** Identifies a list of resources in reading order for the publication. */\n  public readonly readingOrder: Links;\n\n  /** Identifies resources that are necessary for rendering the publication. */\n  public readonly resources: Links;\n\n  /** Identifies the collection that contains a table of contents. */\n  public readonly tableOfContents: Links;\n\n  public readonly subcollections: { [collection: string]: CoreCollection };\n\n  constructor(manifestJSON: any) {\n    const json = new JSONDictionary(manifestJSON);\n\n    this.context = json.parseArray('@context');\n    this.metadata = new Metadata(json.parseRaw('metadata'));\n    this.links = new Links(json.parseArray('links'));\n    this.readingOrder = new Links(json.parseArray('readingOrder'));\n    this.resources = new Links(json.parseArray('resources'));\n    this.tableOfContents = new Links(json.parseArray('toc'));\n    this.subcollections = CoreCollection.makeCollections(json.json);\n  }\n\n  /** Finds the first link with the given relation in the manifest's links. */\n  public linkWithRel(rel: string): Link | null {\n    const links: Array<Links> = [this.readingOrder, this.resources, this.links];\n    let result = null;\n\n    for (const collection of links) {\n      result = collection.findWithRel(rel);\n      if (result !== null) {\n        return result;\n      }\n    }\n\n    return result;\n  }\n\n  /** Finds all the links with the given relation in the manifest's links. */\n  public linksWithRel(rel: string): Array<Link> {\n    let result = [];\n    result.push(\n      this.readingOrder.filterByRel(rel),\n      this.resources.filterByRel(rel),\n      this.links.filterByRel(rel)\n    );\n    return result.reduce((acc, val) => acc.concat(val), []);\n  }\n}\n","/* Copyright 2020 Readium Foundation. All rights reserved.\n * Use of this source code is governed by a BSD-style license,\n * available in the LICENSE file present in the Github repository of the project.\n */\n\nimport { CoreCollection } from './CoreCollection';\nimport { Link, Links } from './Link';\nimport { Manifest } from './Manifest';\nimport { Metadata } from './Metadata';\n\n/** Shared model for a Readium Publication. */\nexport class Publication {\n  private manifest: Manifest;\n\n  // Aliases\n  public metadata: Metadata;\n  public links: Links;\n  public readingOrder: Links;\n  public resources: Links;\n  public tableOfContents: Links;\n  public subcollections: { [collection: string]: CoreCollection };\n\n  constructor(manifest: Manifest) {\n    this.manifest = manifest;\n\n    this.metadata = this.manifest.metadata;\n    this.links = this.manifest.links;\n    /** Identifies a list of resources in reading order for the publication. */\n    this.readingOrder = this.manifest.readingOrder;\n    /** Identifies resources that are necessary for rendering the publication. */\n    this.resources = this.manifest.resources;\n    /** Identifies the collection that contains a table of contents. */\n    this.tableOfContents = this.manifest.tableOfContents;\n    this.subcollections = this.manifest.subcollections;\n  }\n\n  /** The URL where this publication is served, computed from the `Link` with `self` relation.\n   *  e.g. https://provider.com/pub1293/manifest.json gives https://provider.com/pub1293/\n   */\n  public baseURL(): string | null {\n    const selfLink = this.manifest.links.find(el => el.rels.has('self'));\n    if (selfLink) {\n      return selfLink.href;\n    } else {\n      return null;\n    }\n  }\n\n  /** Finds the first Link having the given `href` in the publication's links. */\n  public linkWithHref(href: string): Link | null {\n    const find = (links: Array<Links>): Link | null => {\n      let result = null;\n\n      for (const collection of links) {\n        result = collection.findWithHref(href);\n        if (result !== null) {\n          return result;\n        }\n      }\n\n      const children: Array<Links> = links.flatMap(item => {\n        let arr = [];\n        for (const link of item) {\n          if (link.alternates) {\n            arr.push(link.alternates);\n          }\n          if (link.children) {\n            arr.push(link.children);\n          }\n        }\n        return arr;\n      });\n\n      find(children);\n\n      return result;\n    };\n\n    const links: Array<Links> = [\n      this.manifest.readingOrder,\n      this.manifest.resources,\n      this.manifest.links,\n    ];\n\n    const link = find(links);\n\n    if (link !== null) {\n      return link;\n    }\n\n    const shortHref = href.split(/[#\\?]/)[0];\n\n    this.linkWithHref(shortHref);\n\n    return link;\n  }\n\n  /** Finds the first link with the given relation in the publication's links. */\n  public linkWithRel(rel: string): Link | null {\n    return this.manifest.linkWithRel(rel);\n  }\n\n  /** Finds all the links with the given relation in the publication's links. */\n  public linksWithRel(rel: string): Array<Link> {\n    return this.manifest.linksWithRel(rel);\n  }\n}\n","import { Manifest } from './Publication/Manifest';\nimport { Metadata } from './Publication/Metadata';\n//import * as xxx from './Publication/presentation/Metadata+Presentation';\nimport { Publication } from './Publication/Publication';\n\nexport interface JellybooksAPI {\n  createManifest(json: string): Manifest;\n  createPublication(manifest: Manifest): Publication;\n  getData(x: string): string;\n}\n\nexport default function api(): JellybooksAPI {\n  const createManifest = (json: string): Manifest => {\n    return new Manifest(json);\n  };\n\n  const createPublication = (manifest: Manifest): Publication => {\n    return new Publication(manifest);\n  };\n\n  //for test\n  const getData = (x: string): string => {\n      //let m:Metadata;\n      \n      //m.getPresentation()\n\n    return `hi1 - ${x}`;\n  };\n\n  const _api = {\n    createManifest,\n    createPublication,\n    getData,\n  } as JellybooksAPI;\n\n  return _api;\n}\n\nexport { Manifest, Publication, Metadata };\n\n// export const sum = (a: number, b: number) => {\n//   if ('development' === process.env.NODE_ENV) {\n//     console.log('boop');\n//   }\n//   return a + b;\n// };\n"," import api, { JellybooksAPI, Manifest, Publication } from \"@jellybooks/shared-test\";\n// import { JellybooksAPI, Publication, Manifest } from \"@jellybooks/shared-test\";\n\n//import \"@jellybooks/shared-test\";\n//import   \"@jellybooks/shared-test/types/Publication/presentation/Metadata+Presentation\";\n//import * as ddd from \"@jellybooks/shared-test/types/Publication/presentation/Metadata+Presentation\";\n//import { x } from \"@jellybooks/shared-test/types/Publication/presentation/Metadata+Presentation\";\n\nlet textElement: HTMLDivElement = document.getElementById(\"text\") as HTMLDivElement;\n\nconst lib: JellybooksAPI = api()\n\n//textElement.innerText = lib.getData('test');\n\n\nfetch(\"manifest.json\")\n    .then(response => response.json())\n    .then((json) => {\n        //console.log(ddd.x);\n\n        console.log(json);\n        let manifest: Manifest = lib.createManifest(json);\n        const pubObj: Publication = lib.createPublication(manifest);\n        //console.log(manifest.metadata.get);\n        let y = manifest.metadata.getPresentation();\n        \n        console.log(y);\n        console.log(pubObj);\n        textElement.innerText = JSON.stringify(pubObj, null, 2);\n    });\n"],"sourceRoot":""}